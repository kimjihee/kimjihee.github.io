<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Seoul Subway Air Polution</title>
    <style>
/*        @import url(http://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css);*/
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 0.4rem;
        }
        #chart {
            position: absolute;
            top:5rem;
           }
        svg {
            shape-rendering: crispEdges;
          
        }
        #value {display:none;}
        h1 {
            position: absolute;
            top:2rem;
            left:3.7rem;
            font-size:1.5rem;
            font-weight:400;
        }
        .x text {display:none;
        }
        .y text {
         font-size:2rem !important;
         alignment-baseline:middle;}
        .axis path,
        .axis line {
            fill: none;
            stroke: rgb(200,200,200);
            shape-rendering: crispEdges;
        }
       
        
        

    </style>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    <script src="d3.min.js" type="text/javascript"></script>
</head>

<body>
    <h1>Seoul Subway Air Polution</h1>
    <div id="tooltip" class="hidden">
        <p><span id="value">단위,,,'㎍/㎥','ppm','㎍/㎥','ppm','ppm','Bq/㎥','㎍/㎥','개/cc','ppm'</span></p>
</div>
    <svg id="chart"> </svg>
    <script>
         
//--------------------------------------Data---------------------------------------------

         var dataSet = [];
        
        var Workingtime = d3.csv('data/서울지하철역별 공기질.csv', function (err, trainAir) {
            trainAir.forEach(function (row) {
                row["PM10"]=+row["PM10"];
                row["CO2"]=+row["CO2"];
                row["HCHO"]=+row["HCHO"];
                row["CO"]=+row["CO"];
                row["NO2"]=+row["NO2"];
                row["Rn"]=+row["Rn"];
                row["TVOC"]=+row["TVOC"];
                row["석면"]=+row["석면"];
                row["O3"]=+row["O3"];                  
                    
            })
            
            valuePM10 = [0,d3.max(trainAir, function(d) {return d.PM10;})]//nest하기전 dataSet=trainAir
            valueCO2 = d3.extent(trainAir, function(d) {return d.CO2;});
            vlaueHCHO = d3.extent(trainAir, function(d) {return d.HCHO;});
            vlaueCO = d3.extent(trainAir, function(d) {return d.CO;});
            valueNO2 = d3.extent(trainAir, function(d) {return d.NO2;});
            valueRn = d3.extent(trainAir, function(d) {return d.Rn;});
            valueTVOC = d3.extent(trainAir, function(d) {return d.TVOC;});
            value석면 = d3.extent(trainAir, function(d) {return d.석면;});
            valueO3 = d3.extent(trainAir, function(d) {return d.O3;});
             console.log(valueO3);                                                                         
            dataSet = d3.nest()
                .key(function(d){
                    return d.Stop;
                })
                .entries(trainAir); 
            
            
            
            redraw();
      
       });
       
        
        
        var redraw = function(){
            
            
            
            MARGIN = {
                TOP: 0,
                LEFT: 0,
                RIGHT: 10,
                BOTTOM: 0
            };
            
            var Width = 1200;
            var Height = 50;
            
            var countryNames = dataSet.map(function(d) {return d.key;});
            var xScale= d3.scale.ordinal()
                .domain(countryNames)//어떨때 ([])이고 어떨때 ("")인지 질문
                .rangeRoundBands([0,Width-MARGIN.LEFT-MARGIN.RIGHT],0.3);
            var PM10Scale= d3.scale.linear()
                .domain([valuePM10])
                .range([0,Height]);
            
            var colorScale = d3.scale.ordinal()
            .domain(['1호선','2호선','3호선','4호선'])
            .range(['#5090cf','#57b057','#f78d41','#7bb6e2']);
            
            var xAxis = d3.svg.axis()
            .scale(xScale)
            .orient('bottom')
            .tickFormat(function(d){return d;})
            .tickSize(0)
            .tickPadding(15);
            
            var yAxis = d3.svg.axis()
            .scale(PM10Scale)
            .orient('left')
            .tickPadding(10)
            .tickSize(14);
            
            var svg = d3.select('svg')
            .attr('width',Width+50)
            .attr('height',Height+300);
            
            
            var realChart = svg
            .append('g')
            .attr('class','Airs')
            .attr("transform","translate("+50+","+30+")")
            ;
            
            realChart.append('g')
            .attr('class','x axis')
            .attr('transform',"translate("+0+","+Height+")")
            .call(xAxis);
            
             realChart.append('g')
            .attr('class','y axis')
            .attr('transform',"translate("+0+","+0+")")
            .call(yAxis)
             ;
            
            var groupData = d3.select('g.Airs').selectAll("g").data(dataSet);
            
            var pickRect = groupData.selectAll("rect").data(function(d){return d.values});
            pickRect
                .enter()
                .append('rect')
                .attr('class','bar')
                .attr('x',function(d,i){return Width/102*i;})
                .attr('y',function(d){return Height-(d.PM10*0.2);})//반대로 채워준다고 생각하면 됨
                .attr('height',function(d){return d.PM10*0.2;})
                .attr('width',xScale.rangeBand())//이것이 band로 나눠진 너비
                .style("fill", function (d) {
                                return colorScale(d.Number);})
                .attr('transform',"translate("+0+","+-50+")")
                .append("title")
                    .text(function (d,i) {
                    return d.Stop ;
                    });

            
            
        };
    </script>
    </body>
</html>