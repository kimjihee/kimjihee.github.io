<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Child labour</title>
    <style>
        body {
            position: absolute;
            top: 2rem;
            left: 0;
            right: 0;
            font-family: sans-serif;
        }
        
        .top {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
        }
        
        .name {
            float: left;
            list-style-type: none;
        }
        
        h1 {
            display: none;
            padding: 0;
            margin: 0;
        }
        
        
//------------------------------------------Data----------------------------------------- 
        
        
        #tooltip {
            position: absolute;
            width: 10px;
           background-color:aquamarine;
            height: 10px;
            pointer-events: none;
        }
        
        #tooltip.hidden {
            display: none;
        }
        
        .IamSVG {
            position: absolute;
            top: 6rem;
            left: 3rem;
        }
        
        p {
            color: black;
            padding-left: 1rem;
            font-size: 0.8rem;
            margin: 0;
            padding: 12;
        }
        
        .label {
            text-align: right;
        }
    </style>
    <script src="d3.min.js" type="text/javascript"></script>
</head>

<body>
    <div class="top">
        <h1>Child Labour</h1> </div>
    <div id="tooltip" class="hidden" style="">+'%'</div>
    <p> </p>
    <svg height="3000" width="1000" class="iamSvg">
        <text x='160' y='20' fill='black' text-anchor="end" font-size='rem' font-weight='bolder'>Country</text>
        <text x='200' y='20' fill='black' font-size='rem' font-weight='bolder'>Labour male</text>
        <text x='350' y='20' fill='black' font-size='rem' font-weight='bolder'>Labour female</text>
        <text x='520' y='20' fill='black' font-size='rem' font-weight='bolder'>Male none attendace
            <tspan x="530" y="39" font-weight='normal'>(in primary education)</tspan>
        </text>
        <text x='700' y='20' fill='black' font-size='rem' font-weight='bolder'>Female none attendace
            <tspan x="700" y="39" font-weight='normal'>(in primary education)</tspan>
        </text>
    </svg>
    
    
    
    <script>
        var dataSet = [];
        // labour data
        d3.csv('data/Child_labour.csv', function (err, labour) {
            d3.csv('data/attendance_in_primary_education.csv', function (err, attend) {
                labour.forEach(function (row) {
                    row['Labour'] = +row['Value'];
                });
                
                
                
                var labourMale = labour.filter(function (row) {
                    return row['Subgroup'].startsWith('Male');
                });
                var labourFemale = labour.filter(function (row) {
                    return row['Subgroup'].startsWith('Female');
                });
                attend.forEach(function (row) {
                    row['Attend'] = +row['Value'];
                });
                var attendMale = attend.filter(function (row) {
                    return row['Subgroup'].startsWith('Male');
                });
                var attendFemale = attend.filter(function (row) {
                    return row['Subgroup'].startsWith('Female');
                });
                
                
 //----------------------------------------CountryName----------------------------------------    
                
                
                
                var mergedDict = {};
                labourMale.forEach(function (row, i) {
                    var key = row['Country'];
                    mergedDict[key] = row;
                    mergedDict[key].LabourFemale = labourFemale[i].Labour;
                });
                attendMale.forEach(function (row, i) {
                    var key = row['Country'];
                    if (!mergedDict[key]) {
                        mergedDict[key] = row;
                    }
                    else {
                        mergedDict[key]['Attend'] = row['Attend'];
                    }
                    mergedDict[key].AttendFemale = attendFemale[i].Attend;
                });
                var mergedData = [];
                for (var key in mergedDict) {
                    mergedData.push(mergedDict[key]);
                }
                //                var countriesFromLabour = [];
                //                for(var i = 0; i < labour.length; i++) {
                //                    var row = labour[i];
                //                    countriesFromLabour.push(row['Country']);
                //                }
                //                var countriesFromLabour = labour.map(function(row) {
                //                    return row['Country'];
                //                });
                //                var countriesFromAttend = attend.map(function(row) {
                //                    return row['Country'];
                //                });
                dataSet = mergedData;
//                console.log(dataSet);
                redraw();
            });
        });
        
        
//------------------------------------------Draw------------------------------------------
        
        
        var height = 50;

        function redraw() {
            var rects = d3.select('svg').selectAll('.label').data(dataSet);
            rects.enter()
                .append('text')
                .attr('class', 'label')
                .attr('x', 160)
                .attr('fill', 'black')
                .attr('text-anchor', 'end')
                .attr('font-size', '11px');
            // Exit
            rects.exit().remove();
            // Update
            rects.attr('y', function (_, i) {
                return 20 + height + i * 20;
            })
                .text(function (d) {
                return d['Country'];
            });
            
            
            
            
 //------------------------------------------labourMale-----------------------------------------
            
            
                
            var rects = d3.select('svg').selectAll('.labourMale').data(dataSet);
            rects.enter()
                .append('rect')
                .attr('class', 'labourMale')
                .attr('x', 200)
                .attr('width', 0)
                .attr('height', 15)
                .attr('fill', 'grey')
                .attr('fill-opacity', '0.5')
                .on("mouseover", function () {
                d3.select(this).attr("fill", "rgb(10,10,10)");})
                .on("mouseout", function () {
                d3.select(this).attr("fill", "grey");
            });
            
        
            // Exit
            rects.exit().remove();
            
            // Update
            rects.attr('y', function (_, i) {
                return 10 + height + i * 20;
            }).transition()
                .duration(1000)
                .attr('width', function (d) {
                return (d['Labour'] || 0) * 2;
            });
            
            
            
            rects.enter()
                .append('text')
                .text(function (d) {
                return (d['Labour']);
            }).attr('x', function (d) {
                return (d['Labour']) * 2 + 215;
            }).attr('y', function (_, i) {
                return 20.5 + height + i * 20;
            }).attr('font-family', 'sans-serif')
                .attr('font-size', '11px')
                .attr('fill', 'grey')
                .attr('text-anchor', 'end');
            
            
//---------------------------------------labourFemale---------------------------------------------------
             
            var rects = d3.select('svg').selectAll('.labourFemale').data(dataSet);
            rects.enter()
                .append('rect')
                .attr('class', 'labourFemale')
                .attr('x', 360)
                .attr('width', 0)
                .attr('height', 15)
                .attr('fill', 'grey')
                .attr('fill-opacity', '0.5')
                .on("mouseover", function () {
                d3.select(this).attr("fill", "rgb(10,10,10)");})
                .on("mouseout", function () {
                d3.select(this).attr("fill", "grey");
            });
            
        
            // Exit
            rects.exit().remove();
            
            // Update
            rects.attr('y', function (_, i) {
                return 10 + height + i * 20;
            }).transition().duration(1000).attr('width', function (d) {
                return (d['Labour'] || 0) * 2;
            });
            
                        
            rects.enter()
                .append('text')
                .text(function (d) {
                return (d['Labour']);
            }).attr('x', function (d) {
                return (d['Labour']) * 2 + 375;
            }).attr('y', function (_, i) {
                return 20.5 + height + i * 20;
            }).attr('font-family', 'sans-serif')
                .attr('font-size', '11px')
                .attr('fill', 'grey')
                .attr('text-anchor', 'end');
            
            
//------------------------------------------Attend data-------------------------------------------
            
            
            var rects = d3.select('svg').selectAll('.attend').data(dataSet);
            
                        rects.enter()
                            .append('text')
                            .text(function (d) {
                                return (100 - d['Attend']);
                            })
                            .attr('x', function (d) {
                                return (100 - d['Attend']) * 2 + 535;
                            })
                            .attr('y', function (_, i) {
                                return 20.5 + height + i * 20;
            
            
                            })
                            .attr('font-family', 'sans-serif')
                            .attr('font-size', '11px')
                            .attr('fill', 'grey')
                            .attr('text-anchor', 'end'); // 이걸 아래로 옮겼더니 실행이 안됐는데 위로 옮기니까 되었어요!!!!!!!!
            rects
                .enter()
                .append('rect')
                .attr('class', 'attend')
                .attr('x', 520)
                .attr('width', 0)
                .attr('height', 15)
                .attr('fill', 'grey')
                .attr('fill-opacity', '0.5')
                .on("mouseover", function () {
                d3.select(this).attr("fill", "rgb(10,10,10)");
            }).on("mouseout", function () {
                d3.select(this).attr("fill", "grey");
            });
            
            // Exit
            rects.exit().remove();
            
            // Update
            rects.attr('y', function (_, i) {
                return 10 + height + i * 20;
            }).transition()
                .duration(1000)
                .attr('width', function (d) {
                return (100 - d['Attend'] || 0) * 2;
            });
        }
        
        
        
        //------------------------------------------ Sort-----------------------------------------
        //        svg.selectAll('text').enter().on("click", function() {
        //                			   		sortBars();
        //			   });
        //        
        //        	var sortOrder = false;
        //			
        //			//Define sort function
        //			var sortBars = function() {
        //
        //				//Flip value of sortOrder
        //			   	sortOrder = !sortOrder;
        //
        //				svg.selectAll("rect")
        //				   .sort(function(a, b) {
        //				   		if (sortOrder) {
        //					   		return d3.ascending(a, b);
        //				   		} else {
        //					   		return d3.descending(a, b);
        //				   		}
        //				   	})
        //				   .transition()
        //				   .delay(function(d, i) {
        //					   return i * 50;
        //				   })
        //				   .duration(1000)
        //				   .attr("y", function(d, i) {
        //				   		return 10 + height + i * 20;
        //				   });
        //
        //			};	
        //        
        //-----------------------------------Country------------------------------------------
        function write() {
            var countryName = d3.select('body').selectAll('p').data(dataSet);
            countryName.enter().append('p').text(function (d) {
                return d['Country'];
            });
        }
    </script>
</body>

</html>