<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <style>
               body {
            position: absolute;
            top: 2rem;
            width: 4rem;
        }
        .iamSvg {position:absolute;
        top:2rem;
        left:3rem;}
        
        p { color: black;
            padding-left: 1rem;
            font-size:0.8rem;
            margin:0;
            padding:12;
        }
        
    </style>
    <script src="d3.min.js" type="text/javascript"></script>
</head>

<body>
    <svg height="2000" width="700" class="iamSvg">
    </svg>

    <p> </p>

    <script>
        var dataSet = [];

        // labour data
        d3.csv('data/Child_labour.csv', function (err, labour) {
            d3.csv('data/attendance_in_primary_education.csv', function (err, attend) {
                labour.forEach(function (row) {
                    row['Labour'] = +row['Value'];
                });

                labour = labour.filter(function (row) {
                    return row['Subgroup'].startsWith('Male');
                });
                
                attend.forEach(function (row) {
                    row['Attend'] = +row['Value'];
                });
                attend = attend.filter(function (row) {
                    return row['Subgroup'].startsWith('Male');
                });
                
                var mergedDict = {};
                labour.forEach(function (row) {
                    var key = row['Country'];
                    mergedDict[key] = row;
                });
                attend.forEach(function (row) {
                    var key = row['Country'];
                    if(!mergedDict[key]) {
                        mergedDict[key] = row;
                    } else {
                        mergedDict[key]['Attend'] = row['Attend'];
                    }
                });
                var mergedData = [];
                for(var key in mergedDict) {
                    mergedData.push(mergedDict[key]);
                }
                
//                var countriesFromLabour = [];
//                for(var i = 0; i < labour.length; i++) {
//                    var row = labour[i];
//                    countriesFromLabour.push(row['Country']);
//                }
//                var countriesFromLabour = labour.map(function(row) {
//                    return row['Country'];
//                });
//                var countriesFromAttend = attend.map(function(row) {
//                    return row['Country'];
//                });

                dataSet = mergedData;
                redraw();
            });
        });


                function redraw() {
                    var rects = d3.select('svg').selectAll('.label').data(dataSet);
                    rects.enter()
                        .append('text')
                        .attr('class', 'label')
                        .attr('x', 40)
                        .attr('fill', 'black');
        
                    // Exit
                    rects.exit()
                        .remove();
        
                    // Update
                    rects.attr('y', function (_, i) {
                        return 20 + i * 20;
                    })
                    .text(function(d) {return d['Country'];});

                    var rects = d3.select('svg').selectAll('.labour').data(dataSet);
        
                    rects.enter()
                        .append('rect')
                        .attr('class', 'labour')
                        .attr('x', 150)
                        .attr('width', 0)
                        .attr('height', 15)
                        .attr('fill', 'skyblue')
                        .attr('fill-opacity','0.3');
        
                    // Exit
                    rects.exit()
                        .remove();
        
                    // Update
                    rects.attr('y', function (_, i) {
                            return 10 + i * 20;
                        })
                        .transition()
                        .attr('width', function (d) {
                            return (d['Labour'] || 0) * 2;
                        });
        
                    var rects = d3.select('svg').selectAll('.attend').data(dataSet);
        
                    rects.enter()
                        .append('rect')
                        .attr('class', 'attend')
                        .attr('x', 300)
                        .attr('width', 0)
                        .attr('height', 15)
                        .attr('fill', 'grey')
                    .attr('fill-opacity','0.3');
        
                    // Exit
                    rects.exit()
                        .remove();
        
                    // Update
                    rects.attr('y', function (_, i) {
                            return 10 + i * 20;
                        })
                        .transition()
                        .attr('width', function (d) {
                        return (d['Attend'] || 0) * 2;
                    });
                }
        
        function write() {
            var countryName = d3.select('body').selectAll('p').data(dataSet);
            countryName.enter()
                .append('p').text(function(d){return d['Country'];});
        }
        

        
        
    </script>
</body>

</html>