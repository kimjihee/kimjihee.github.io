<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>workingTime</title>
    <style>
/*        @import url(http://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css);*/
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 0.4rem;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        .domain {
            display:none;
        }
        
        .tick line{stroke:rgba(200,200,200,0.5);}
        
        .x aixs tick text {text-anchor:start;}
    </style>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    <script src="d3.min.js" type="text/javascript"></script>
</head>

<body>
    <svg id="chart"> </svg>
    <script>
         
//--------------------------------------Data---------------------------------------------

        
        var dataSet = [];
        var valueData = [];
        var Workingtime = d3.csv('data/working_hours_per_week.csv', function (err, times) {
            for(var i = 0; i < times.length; i++) {
                var time = times[i];
                var country = time['Country'];
                delete time['Country'];
                for(var year in time) {
                    valueData.push({
                        Country: country,
                        Year: +year,
                        Value: +time[year]
                        });
                   
                }
            
            }
            
////            
//             for(j=0; j<valueData.length; j++) {
//                if(valueData[j].Value === 0){ return  20; }
//            }
//            
//              
//                 valueData.forEach(function (d, i) {
//                    if(d.Value===0){
//                        return d.Value = 20;
//                    } 
//                    
//                });
            
            
            yearExtent = d3.extent(valueData, function(d) {return d.Year;});
            valueExtent = d3.extent(valueData, function(d) {return d.Value;});
                          
            dataSet = d3.nest()
                .key(function(d){
                    return d.Country;
                })
                .entries(valueData);
           
             for(i=0; i<dataSet.length; i++){     
                         
                        for(j=0; j<28; j++){
                            
                    var Sum = d3.min(dataSet[i].values.filter(function(d) {
                        return d.Value !== 0;}), function(d) {return d.Value;}
                                       );//필터를 쓰는경우 필터(안에는); 
//                    var Num = dataSet[i].values.filter(function(d) {return d.Value !== 0;});
////                    var Num2 = Num.length; // 각각 value 마다 0이 아닌 개수를 찾아 나눠줘야함
                
                        if(dataSet[i].values[j].Value===0) {
                                                  
                        dataSet[i].values[j].Value = Sum;                      
                                                   
                }}}
            
//          console.log(Num);
                     
           redraw();                        
//          values 와 Value의 차이  
            
       });
        
     console.log(dataSet);
        
             var redraw = function () {   
//------------------------------------------Draw------------------------------------------
                                 
                    var MARGIN = {
                        START:0
                        , TOP: 50
                        , LEFT: 100
                        , RIGHT: 100
                        , BOTTOM: 0
                    , }
         
                    var Width = 800;
                    var Height =250;

//------------------------------------------One Graph-------------------------------------                         console.log(yearExtent);

                    var xScale = d3.scale.linear()
                        .domain([1980,2008])//여기는 데이터 전체가 아니라 시작부터 끝.
                        .rangeRound([0, Width]);//라운드랑 밴드랑 먼지모름.
                
                    var yScale = d3.scale.linear()
                        .domain(valueExtent)
                        .rangeRound([Height,0]);
                 
                    var xAxis = d3.svg.axis()
                        .scale(xScale)
                        .orient('bottom')
                        .tickFormat(function (d) {
                         return d;})
                        .tickSize(-250)
                        .tickPadding(15);


                    var yAxis = d3.svg.axis()
                        .scale(yScale)
                        .orient('left')
                        .tickSize(0)
                        .tickPadding(5)
                        ;
                         


                    var svg = d3.select("svg")
                        .attr("width",Width+100)
                        .attr("height", Height+80);

                    var realChart = svg
                        .append('g')
                        .attr("transform", "translate( "+50+" ,"+ 60 +")")
                        ;



                    realChart.append('g')
                        .attr('class', 'x axis')
                        .attr("transform", "translate( 0 ," + Height + ")")
                        
//                      .attr('stroke-width','0')
                        .call(xAxis)
                   
                        ;



                    realChart.append('g')
                      .attr('class', 'y axis')
                      .attr('stroke-width','0')
                      .attr("transform", "translate( "+-20+" ," + 0 + ")")
                     
                      .call(yAxis)
                      .append("text")
                      .attr("transform", "rotate(-90)")
                      
                      .attr("y", 6)
                      ; 
                  
                 
                  var time = d3.svg.line()
                        .x(function(d) { return xScale(d.Year); })
                        .y(function(d) { return yScale(d.Value); })
                        .interpolate("monotone");

                 
                    var dataLines = realChart.selectAll('path.workTime').data(dataSet);
                    dataLines.enter()
                        .append("path")
                        .attr("class", "workTime")
                        .style('fill',"none")
                        .style('stroke',"#cc0101")
                        .style('opacity', 0.2)
                        .style('stroke-width',"2.5px");
                        
                    dataLines.exit()
                        .remove();
                    dataLines
                        .attr("d",   function(d){
                      return time(d.values);}
                        )
                    ;
                   
                    dataLines.on("mouseover", function () {
                            d3.select("path.workTime")
                              .attr('fill-opacity', '1')
                              .append('text', function (d){return d.Country;} );}
                           )
                          .on("mouseout",  function () {
                            d3.selectAll(this)
                              .attr('fill-opacity', '0.2');}
                           );

             };
                 
    </script>
    </body>
</html>
