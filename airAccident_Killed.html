<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Air Accident Killed</title>
    <style>
/*        @import url(http://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css);*/
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 0.4rem;
        }
        #chart {position: absolute;
        top:5rem;}
        svg {
            shape-rendering: crispEdges;
          
        }
        h1 {
            position: absolute;
        top:1rem;
        left:8.5rem;
            font-size:1.5rem;
        }
        .x text {font-size:0.9rem !important;}
        .y text {font-size:0.1rem !important;
        /}
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        	#tooltip {
				position: absolute;
				
				height: auto;
				padding: 10px;
				background-color: white;
				
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
			
			#tooltip.hidden {
				display: none;
			}
			
			#tooltip p {
				margin: 0;
				font-family: sans-serif;
				font-size: 0.8rem;
				
			}
        

    </style>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    <script src="d3.min.js" type="text/javascript"></script>
</head>

<body>
    <h1>Air Accident Killed</h1>
    <div id="tooltip" class="hidden">
        <p><span id="value"></span>time</p>
</div>
    <svg id="chart"> </svg>
    <script>
         
//--------------------------------------Data---------------------------------------------

         var dataSet = [];
        var valueData = [];
        var Workingtime = d3.csv('data/indicator_air accident killed.csv', function (err, times) {
            for(var i = 0; i < times.length; i++) {
                var time = times[i];
                var country = time['Country'];
                delete time['Country'];
                for(var year in time) {
                    valueData.push({
                        Country: country,
                        Year: +year,
                        Value: +time[year]//여기 다시 물어보기
                    });
                }
              }
            
            dataSet = d3.nest()
                .key(function(d){
                    return d.Country;
                })
                .entries(valueData); 
            
     
            redraw();
      
       });

        var redraw = function () {   
//------------------------------------------Draw------------------------------------------
                                 
                    var MARGIN = {
                        START:0
                        , TOP: 50
                        , LEFT: 100
                        , RIGHT: 100
                        , BOTTOM: 0
                    , }
         
                    var Width = 1000;
                    var Height =1300;
//-----------------------------------------AddColunm--------------------------------------                 
           var columnSel = d3.select('#chart')
                .attr("width", Width+100)
                .attr("height", Height)
                .selectAll('g.column').data(dataSet);

            columnSel.enter()
                .append('g')
                .attr('class', function (d) {
                    return 'column ' + d.key;
                })
               ;
                    
            columnSel.exit().remove();
            columnSel.attr('transform', function (d,i) {
                return 'translate(0,' + (Math.floor(i%133)*(Height/133))+') ';
            });//그룹으로 묶어 주고 싶은 것을 정해서 x축으로 묶어줄지 y축으로 묶어줄지 정하고
//            지정한다. 여기서는 y축 방향으로 한 나라의 그룹을 만들기 위해 너비를 x축 숫자로 나눠줌
//                    'translate(' + (Math.floor(i%133)*(Width/133))+',0) '
//------------------------------------------One Graph-------------------------------------                         console.log(yearExtent);
                    var countryNames = dataSet.map(function(d) {return d.key;});
                    
                 
                   var xScale = d3.scale.linear()
                        .domain([1970,2008])
                        .rangeRound([0, Width]);
                
                     var yScale = d3.scale.ordinal()
                        .domain(countryNames)
                        .rangeBands([0,Height],0.1);
            
                                     
                    var colorScale = d3.scale.quantize()
                    .domain([
                        d3.max(valueData, function (d) {
                            return d.Value;
                        }),
                        0
                    ])
                    .range([ '#67000d', '#a50f15', '#cb181d', '#ef3b2c', '#fc9272', '#fcbba1'
                   , 'white']); 
                 
                    console.log(colorScale.domain());// domain은 이렇게 알수 있다.
                    var xAxis = d3.svg.axis()
                        .scale(xScale)
                        .orient('bottom')
                        .tickFormat(function (d) {
                         return d;
                         })
                    
                        ;   
                 
                    var yAxis = d3.svg.axis()
                        .scale(yScale)
                        .orient('left')
                        .tickFormat(function(d) {return d;})
                        .tickPadding(-5)
                        ;
                      
                    var svg = d3.select("svg")
                        .attr("width",Width+200)
                        .attr("height", Height+50);

                    var realChart = svg
                        .append('g')
                        .attr("transform", "translate( "+130+" ," + 40 + ")");
 
                 realChart.append('g')
                        .attr('class', 'x axis')
                        .attr("transform", "translate( "+-2+","+-40 + ")")
                        .style('stroke-width','0')
                        .call(xAxis)
                        .selectAll('text')
                        .style('text-anchor', 'start');//x축 텍스트 정렬은 이렇게!!

                   realChart.append('g')
                      .attr('class', 'y axis')
                      .style('stroke-width','0')
                      .style('font-size','0.3rem')
                      .style('text-anchor','end')// 이게 x축에 적용이 된다.
                      .call(yAxis);
                  
                    var cellHeight = Height/133;//132로 나눠야 맞다.
                     var cellWidth = Width/38;  //38로 나눠야 맞는 이유가 머야?     
                 
                                      
                    var rect = columnSel.selectAll(".day")
                        .data(function(d){
                              return d.values;})
                        .enter()
                        .append("rect")
                        .attr("class", function(d){
                              return  "day " + d.Country;})
                         .attr("transform", "translate( " + 130 + " ,"+ 40 +")")
                        .attr("width", cellWidth - 1)
                        .attr("height", cellHeight - 1)
                        .attr("x", function (d,i) {
                            return Math.floor(i%38)*cellWidth;
                        });
//                        .datum(dateFormat);//이건 머지?
                 
                     rect.style("fill", function (d) {
                                return colorScale(d.Value);})
                     
//                     .on("mouseover", function(d) {
//                  
//                        d3.select("#tooltip")
//                            .attr("x", "inherit")						
//                            .select("#value")
//                            .text(d.Value);
//
//                        d3.select("#tooltip").classed("hidden", false);
//
//                       })
//                       .on("mouseout", function() {
//
//                        //Hide the tooltip
//                        d3.select("#tooltip").classed("hidden", true);
//
//                       })
			  ;

                      rect.append("title")
                          .text(function (d,i) {
                    return d.Country+" " + d.Value;
                });
             };
                 
    </script>
    </body>
</html>
