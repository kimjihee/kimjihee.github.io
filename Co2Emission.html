<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>C02 Emission</title>
    <style>
        @import url(http://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css);
        body {
            font-family: 'Roboto', sans-serif;
            font-size:0.5rem;
        }
        #chart{ border :1px solid black;}
        
        .axis path, .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }
        
      </style>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    
    <script src="d3.min.js" type="text/javascript"></script></head>
    <body>
        <svg id="chart" > </svg>
        
        
        
        <script>

//--- Data---------------------------------------------
        var dateFormat = d3.time.format('%Y');
        var dataSet = [];
//            tonsPerCapita;
        var Emission = d3.csv('data/CO2emissions.csv', function (err, CO2) {
            CO2.forEach(function (row) {
                row['Country'] = row['Country'];
                row['Value'] = +row['Value']; 
                row['Year'] = +row['Year']; 
                
            });   
            
            var Nest = d3.nest()
            .key(function(d){
                return d.Country;
               
            })
            .entries(CO2);         
            

            
                       
//             var C02Small = {};
//            
//                 C02.forEach(function (row, i) {
//                    var Number= +row['Year'];
//                     
//                    C02Small = [(Number.substr(0, 4) - 1960)  + i].Year;
//                     console.log(d.substr(0, 4));
//                });
//            
//            
//             var MappingData = [];
//             for (var key in Mapping) {
//                    MappingData.push(Mapping[key]);
//                }
//            
//            
//            var oneYear = CO2.filter(function (row) {
//                    return row['Year'].startsWith('2011');
//                });  
//
//            
//            var Mapping = {};
//                 oneYear.forEach(function (row, i) {
//                    var key = row["Country"]
//                    Mapping[key] = row;
//                    Mapping[key] = oneYear[i].Country;
//                    
//                });
//            
//             var MappingData = [];
//             for (var key in Mapping) {
//                    MappingData.push(Mapping[key]);
//                }
//            
//            console.log(MappingData);
//            
//           
//            var Data = MappingData.map(function (c) {
//                return CO2.map(function (d) {
//                    return {
//                        x: d.Value,
//                        y: d.Year,
//                       
//                    };
// 
//                });
//            });            
//            이렇게 하면 돼 안될까?
//            var countryName = function(d,i){return oneYear[i].Country;};
//            
                       
            dataSet = Nest;
            redraw();           
           
  
            
       });     
        
       console.log(dataSet);  
            
            var redraw= function(){
     
            
            var Width = 200;
            var Height = 100;
                
                
            var xScale = d3.time.scale()
                .domain([
                new Date(dataSet[0].values[0].Year), d3.time.year.offset(new Date(dataSet[0].values[52].Year)
               ,1)])      
                .rangeRound([0, Width]);
                
                
            console.log(xScale.domain);// console.log로 도메인은 어떻게 보는걸까?
            
            var yScale = d3.scale.linear()
                .domain([0, d3.max(dataSet, function (d,i) {
                   
                    return d[0].values[i].Value;
                                })
                        ])
                .rangeRound([Height, 0]);
            

          var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient('bottom')
                .ticks(d3.time.date, 1)//start stop //이렇게 1이 스탑인데 맞나요?
                .tickFormat(d3.time.format('%Y'))
                .tickSize(0)
                .tickPadding(8)
                ;
            

            var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient('left')
                .tickPadding(8)
                ; 
            
            
                var svg = d3.select("svg")
                .attr("width",Width+100)
                .attr("height", Height);
            
            var realChart = svg
                .append('g');
                

            
            realChart.append('g')
                .attr('class', 'x axis')
                .style('stroke-width','3')
                .call(xAxis);
            
           

            realChart.append('g')
              .attr('class', 'y axis')
              .call(yAxis)
              .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", "1em") 
              .style("text-anchor", "end")
              .text("Tons Per Capita");

       };
    
        </script>
</body>
</html>