<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Seoul Weather</title>
    <style>
        @import url(http://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css);
        body {
            font-family: 'Roboto', sans-serif;
            font-size:0.5rem;
        }
        #chart{
            position: absolute;
            top:2rem;
        }
        .name {
            position: absolute;
            top:4rem;
            left:3.5rem;
            font-size:1.5rem;
        }
        .x text{
            text-anchor: end !important;
        }
        .axis path, .axis line {
            fill: none;
            stroke: rgb(119,119,119);
            stroke-width:1px;
            shape-rendering: crispEdges;
        } 
        span {
            display:block;
            width:10px !important;
            height:10px !important;
            margin-left:5rem;
            font-size:1rem;}
        .a{
            background-color:#fece31;
        }   
        .h{
            background-color:#f78d41;
        }
        .l{
            background-color:#57b057;
            margin-left:3.5rem !important;
        }
        .W{
            position: relative;
            top:-1rem;
            right:-1rem;
        }
        .P {position: relative;
            left:-0.45rem !important;
            
        }
        .colorChart{
            position: absolute;
            bottom:19.2rem;
            right:22.5rem;
        }   
        .colorChart li {
            float:left;
            list-style-type:none;
            
        }
      </style>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    
    <script src="d3.min.js" type="text/javascript"></script></head>
    <body>
        <div class="name">Seoul degree on june, july
        </div>
         <ul class="colorChart">
            <li><span class="a"></span><span class="W">average</span></li>
            <li><span class="h"></span><span class="W">high</span></li>
            <li><span class="l"></span><span class="W P">low</span></li>
            </ul>
        <svg id="chart" > </svg>
        
        
        
        <script>

//--- Data---------------------------------------------
        var dateFormat = d3.time.format('%Y-%m-%d');
        var dataSet = [];
        var Sweather = d3.csv('data/Seoul_weather.csv', function (err, weather) {
            weather.forEach(function (row) {
                row['average'] = +row['average'];
                row['low'] = +row['low'];
                row['high'] = +row['high'];        
                
             row['date']= dateFormat.parse(row['date']);// d3 format으로 검색하면 나옵니다.
                
            })    
         
            dataSet = weather;
            redraw();
       });
        
           
              

//--- Layout--------------------------------------------
            
        var redraw = function () {               
            
            MARGIN = {
                TOP : 100,
                LEFT:50,
                RIGHT:100,
                BOTTOM:100
                };

//--- chart Size ---------------------------------------------
            
          var Width = 1000;
          var Height = 400;
          
//--- Timeformat ---------------------------------------
            
//            var parseDate = d3.time.format("%y-%b-%d").parse; parse 이게 object로 바꾸는것.
  
//--- Scale --------------------------------------------
            
            
            var xScale = d3.time.scale()
            .domain([
                new Date(dataSet[0].date),
                d3.time.day.offset(new Date(dataSet[dataSet.length - 1].date), 1)
            ])//여기서 1은 offset 안에 있는것이므로 이것을 검색하면 알 수 있다.
            .rangeRound([0,Width-MARGIN.LEFT]);
            
            
            var yScale = d3.scale.linear()
            .domain([d3.max(dataSet, function(d) { return d.high; }),0])//여기서 0은 시작점점
            .rangeRound([0,Height-MARGIN.TOP-MARGIN.BOTTOM]);
            
//--- Axis ---------------------------------------------    
            
            var xAxis = d3.svg.axis()//axis 라는 함수안에 data, enter, append 가 알아서 생성되는게 들어있다.
                .scale(xScale)
                .orient('bottom')
                .ticks(d3.time.date, 2)//start stop //이렇게 1이 스탑인데 맞나요?
                .tickFormat(d3.time.format('%m-%d'))//이거랑 어떻게 써야하는것인가? %e 이거 썻는데 망함
                .tickSize(0)
                .tickPadding(8)
                ;
            

            var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient('left')
                .tickSize(0)
                .tickPadding(8)
                ; 

            
            
// call Axis-------------------------------------------                        
            var svg = d3.select("svg")
                .attr("width",Width+100)
                .attr("height", Height);
            
            var realChart = svg
                .append('g')
                .attr('transform', 'translate(' + MARGIN.LEFT + ', ' + MARGIN.TOP + ')');

            //원래는 이걸 안만들고 위의 svg를 이용하려고 했으나 없으면 안되서 만들어 주었다.
            
            realChart.append('g')
                .attr('class', 'x axis')
                .attr('transform', 'translate(0, ' + (Height - MARGIN.TOP - MARGIN.BOTTOM) + ')')
                .style('stroke-width','3')
                .call(xAxis);
           

            realChart.append('g')
              .attr('class', 'y axis')
              .call(yAxis)
              .append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", "1em") // dy를 검색하면 된다. 
              .style("text-anchor", "end")
              .text("Degree ºC");
          

//---------------------------------------- Gragph --------------------------------------------

          var lineAverage= d3.svg.line()
                    .x(function(d) { return xScale(d.date); })
                    .y(function(d) { return yScale(d.average); }).interpolate("monotone");

            realChart.append("path")
                    .attr("d", lineAverage(dataSet))// .data(dataSet)을 없애니 되었다. 교수님도 모른다고 한다.
                    .attr("class", "lineAverage")
                    .style('fill',"none")
                    .style('stroke',"#fece31")
                    .style('stroke-width',"2.5px");
                
            
            realChart.selectAll("dot")
                    .data(dataSet)
                    .enter()
                    .append("circle")
                    .style('fill',"#fece31")
                    .style('opacity',0)
                    .attr("r",4)
                    .attr("cx", function(d) { return xScale(d.date); })
                    .attr("cy", function(d) { return yScale(d.average); })
                    .append('title')
                    .style('fill','white')
                    .text(function(d,i){return "low degree "+dataSet[i].average;});
            
            var linehigh= d3.svg.line()
                    .x(function(d) { return xScale(d.date); })
                    .y(function(d) { return yScale(d.high); }).interpolate("monotone");

            realChart.append("path")
                    .attr("d", linehigh(dataSet))// .data(dataSet)을 없애니 되었다.
                    .attr("class", "linehigh")
                    .style('fill',"none")
                    .style('stroke',"#f78d41")
                    .style('stroke-width',"2.5px");
            
            
            realChart.selectAll("dot")
                    .data(dataSet)
                    .enter()
                    .append("circle")
                    .style('fill',"#f78d41")
                    .style('opacity',0)
                    .attr("r",4)
                    .attr("cx", function(d) { return xScale(d.date); })
                    .attr("cy", function(d) { return yScale(d.high); })
                    .append('title')
                    .style('fill','white')
                    .text(function(d,i){return "low degree "+dataSet[i].high;});
            

            var linelow= d3.svg.line()
                    .x(function(d) { return xScale(d.date); })
                    .y(function(d) { return yScale(d.low); }).interpolate("monotone");

            realChart.append("path")
                    .attr("d", linelow(dataSet))// .data(dataSet)을 없애니 되었다.
                    .attr("class", "linelow")
                    .style('fill',"none")
                    .style('stroke',"#57b057")
                    .style('stroke-width',"2.5px");
                    
                     

            realChart.selectAll("dot")
                    .data(dataSet)
                    .enter()
                    .append("circle")
                    .style('fill',"#57b057")
                    .style('opacity',0)
                    .attr("r",4)
                    .attr("cx", function(d) { return xScale(d.date); })
                    .attr("cy", function(d) { return yScale(d.low); })
                    .append('title')
                    .style('fill','white')
                    .text(function(d,i){return "low degree "+dataSet[i].low;});
          
               //https://www.sitepoint.com/creating-simple-line-bar-charts-using-d3-js축만들기 참고

        };    //이것은 redraw function;        
    
        </script>
</body>
</html>