<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>workingTime</title>
    <style>
        @import url(http://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css);
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 0.4rem;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
    </style>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    <script src="d3.min.js" type="text/javascript"></script>
</head>

<body>
    <svg id="chart"> </svg>
    <script>
         
//--------------------------------------Data---------------------------------------------
//             yearExtent = for(var i=1980; i<2008; i++){i}// for을 왜 못쓸까?
//            var pickCountries = time.forEach(function (row) {
//                for(var i = 1980; i < 2008; i++) {
//                    d3.max(time, function (d) {
//                      row[i];
//                     })
//                }
//                });           
//            console.log(pickCountries);
        
        var dataSet = [];
        var Workingtime = d3.csv('data/working_hours_per_week.csv', function (err, time) {
            
            time.forEach(function (row){
                row['Country'] = row['Country'];
                row['1980']= +row['1980'];
                 row['1981']= +row['1981'];
                 row['1982']= +row['1982'];
                 row['1983']= +row['1983'];
                 row['1984']= +row['1984'];
                 row['1985']= +row['1985'];
                 row['1986']= +row['1986'];
                 row['1987']= +row['1987'];
                 row['1988']= +row['1988'];
                 row['1989']= +row['1989'];
                 row['1990']= +row['1990'];
                 row['1991']= +row['1991'];
                 row['1992']= +row['1992'];
                 row['1993']= +row['1993'];
                 row['1994']= +row['1994'];
                 row['1995']= +row['1995'];
                 row['1996']= +row['1996'];
                 row['1997']= +row['1997'];
                 row['1998']= +row['1998'];
                 row['1999']= +row['1999'];
                 row['2000']= +row['2000'];
                 row['2001']= +row['2001'];
                 row['2002']= +row['2002'];
                 row['2003']= +row['2003'];
                 row['2004']= +row['2004'];
                 row['2005']= +row['2005'];
                 row['2006']= +row['2006'];
                 row['2007']= +row['2007'];
                  });                                    
                       
            dataSet = time; 
            redraw();
            //여기 네스트 쓰면 망함 왜일까? i가 들어가지고 nan이 된다.
       });
        
        
           console.log(dataSet);
                 
//        var maxMin =[];  
//        maxMin =    d3.max(dataSet, function (d) {
//                      for (var i=1980; i<2008; i++) {
//                      return d.values[i];
//                     }})
//                     //for은 단독으로 쓸수잇나?
//                      console.log(maxMin);
                    
             var redraw = function () {   
//------------------------------------------Draw------------------------------------------
                                 
                    var MARGIN = {
                        START:0
                        , TOP: 50
                        , LEFT: 100
                        , RIGHT: 100
                        , BOTTOM: 0
                    , }
         
                    var Width = 1000;
                    var Height =500;

//------------------------------------------One Graph-------------------------------------                         console.log(yearExtent);
                    var countryNames = dataSet.map(function(d) {return d.Country;});
                    var xScale = d3.scale.linear()
                        .domain([1980,2007])// 여기는 데이터 전체가 아니라 시작부터 끝.
                        .rangeRound([0, Width]);//라운드랑 밴드랑 먼지모름.
                 
                    var yScale = d3.scale.ordinal()
                        .domain(countryNames)
                        .rangeBands([0,Height - MARGIN.TOP - MARGIN.BOTTOM],0.1);
                    
                    var colorScale = d3.scale.quantize()
                        .domain([d3.max(dataSet, function (d) {
                          for(var i =1980; i<2008; i++){
                                return d[i];
                                 }//왜 너는 너이냐?
                                 }) 
                    , d3.min(dataSet, function (d) {
                             for(var i =1980; i<2008; i++){
                             if(d[i] !== 0){ return d[i];}
                           }}
                            )])
                    .range(["red",'rgb(215, 48, 39)', 'rgb(244, 109, 67)', 'rgb(253, 174, 97)', 'rgb(254, 224, 139)', 'rgb(255, 255, 191)', 'rgb(217, 239, 139)',
                    'rgb(166, 217, 106)', 'rgb(102, 189, 99)', 'rgb(26, 152, 80)', 'rgba(250, 250, 250,0)']); 
                 
                    console.log(colorScale.domain());// domain은 이렇게 알수 있다.
                    var xAxis = d3.svg.axis()
                        .scale(xScale)
                        .orient('bottom')
                        .tickSize(3)
                        .tickFormat(function (d) {
                         return d;
                         });   
                 
                    var yAxis = d3.svg.axis()
                        .scale(yScale)
                        .orient('left')
                        .tickFormat(function(d) {return d;})
                        .tickSize(3);
                     
                    var svg = d3.select("svg")
                        .attr("width",Width+200)
                        .attr("height", Height+40);

                    var realChart = svg
                        .append('g')
                        .attr("transform", "translate( "+130+" ," + 20 + ")");

                    realChart.append('g')
                        .attr('class', 'x axis')
                        .attr("transform", "translate( 0 ," + 450 + ")")//이건 어떻게 해야할까?
                        .style('stroke-width','0')
                        .call(xAxis);

                    realChart.append('g')
                      .attr('class', 'y axis')
                      .style('stroke-width','0')
                      .call(yAxis);
                  
                    var cellSize = 450/52;
                                      
                    var rect = svg.selectAll(".day")
                        .data(dataSet)
                        .enter()
                        .append("rect")
                        .attr("class", function(d){
                              return  "day " + d.Country;})
                        .attr("width",  Width/(2008-1980))
                        .attr("height", cellSize)
                        .attr("x", function(d){
                            for(var i =1980; i<2008; i++){
                                return (Width/(2008-1980))*(i-1980)+125}
                        })
                        .attr("y", function (d,i) {
                            return (i*cellSize) + 20;
                        });
//                        .datum(dateFormat);//이건 머지?
                 
                     rect.style("fill", function (d) {
                                return colorScale( 
                                d[1980]
                                 );}
                                 );

                     rect.append("title")
                          .text(function (d,i) {
                            return d.Country;
                        });    
             };
                 
    </script>
    </body>
</html>
