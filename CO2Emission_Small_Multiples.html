<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>C02 Emission</title>
    <style>
        @import url(http://fonts.googleapis.com/earlyaccess/nanumgothiccoding.css);
        body {
            font-family: 'Roboto', sans-serif;
            font-size:0.4rem;
        }

        
        .axis path, .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }
       
      </style>
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css'>
    
    <script src="d3.min.js" type="text/javascript"></script></head>
    <body>
        <svg id="chart" > </svg>
        
        
        
        <script>

//--- Data---------------------------------------------
        var dataSet = [];
        var yearExtent = [];
        var valueExtent = [];
//            tonsPerCapita;
        var Emission = d3.csv('data/CO2emissions.csv', function (err, CO2) {
            CO2.forEach(function (row) {
                row['Country'] = row['Country'];
                row['Value'] = +row['Value']; 
                row['Year'] = new Date(+row['Year'], 0 ,1);
            });
            yearExtent = d3.extent(CO2, function(d) {return d.Year;});
            valueExtent = [0, d3.max(CO2, function(d) {return d.Value;})];
            
            var Nest = d3.nest()
            .key(function(d){
                return d.Country;
               
            })
            .entries(CO2);         
          
            
            
            dataSet = Nest;
            redraw();           
                       
       });     
        
            
     var redraw = function () {   
            
//  ------------------------------------------Draw------------------------------------------
       
           
            var MARGIN = {
                START:0
                , TOP: 50
                , LEFT: 100
                , RIGHT: 100
                , BOTTOM: 0
            , }
//            var Width = document.querySelector('#chart').clientWidth;
//            var Height = document.querySelector('#chart').clientHeight;
                
            var Width = 1200;
            var Height = 500;
////----------------------------------------column----------------------------------------
                
                
            var columnBand = d3.scale.ordinal()
                .domain(['a', 'b', 'c', 'd', 'e'])
                .rangeRoundBands([MARGIN.LEFT, Width - MARGIN.RIGHT], 0.07);
                
                
            var yBand = d3.scale.ordinal()
                .domain(['A', 'B', 'C', 'D', 'E'])
                .rangeBands([0, Height - MARGIN.TOP - MARGIN.BOTTOM], 0.12, 7.9);
            
            var columnSel = d3.select('#chart').selectAll('g.column').data(columnBand.domain());
            
            columnSel.enter()
                .append('g')
                .attr('class', function (d) {
                return 'column ' + d;
            });
            columnSel.exit().remove();
            
            columnSel.attr('transform', function (d) {
                return 'translate(' + columnBand(d) + ', ' + MARGIN.TOP + ')';
            });
                
                
                
                
                
                
//------------------------------------------One Graph----------------------------------------------       
            var width = 200;
            var height = 100;
                
            var xScale = d3.time.scale()
                .domain(yearExtent)
                .rangeRound([0, width]);
            var yScale = d3.scale.linear()
                .domain(valueExtent)
                .rangeRound([height,0]);

          var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient('bottom')
                .ticks(d3.time.year,10)
                //.ticks(d3.time.date,1) 이렇게 바꿨더니 원하는것처럼 tick 개수가 줄어들엇음
                    
                .tickFormat(d3.time.format('%Y'))
                .tickSize(0)
                .tickPadding(8)
                
                ;
            

            var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient('left')
                .tickValues([5,20,50,90])//원하는 숫자 넣을 수 있다.
                .tickSize(0)// 튀어나온 선의 크기
                .tickPadding(5)// 축과 글자 사이의 간격
                ; 
            
            
            var svg = d3.select("svg")
                .attr("width",Width)
                .attr("height", Height);
        
         
           var realChart = svg.select('g.column.a').selectAll('g').data(dataSet);
         
                realChart.enter()
                    .append("g")
                    .attr("width",width+100)
                    .attr("height", height+100)
                    .attr('class',function(d){return 'columna'+ d.values.Country;} );
                realChart.exit()
                    .remove();
                realChart
                    .attr('x', function(d) {
                        return columnBand.rangeBand();
                    })
                    .attr('y', function(d, i) {return yBand(i);})
                    ;
                
         
                   
         
                       
            realChart.append('g')
                .attr('class', 'x axis')
                .attr("transform", "translate( 0 ," + height + ")")
                .style('stroke-width','2')//축 두께
                .call(xAxis);
            
           

            realChart.append('g')
              .attr('class', 'y axis')
              .call(yAxis)
              ;
        
           
            var lineCO2 = d3.svg.line()
                .x(function(d) { return xScale(d.Year);
                                })
                .y(function(d) { return yScale(d.Value); })
                .interpolate("monotone");           
            
         
         
               realChart
                .append("path")
                .attr("d", lineCO2(dataSet[220].values)
                )
                .style('fill',"none")
                .style('stroke',"green")
                .style('opacity', 1)
                .style('stroke-width',"1px")
                ;
      
          
            //data binding을 하는것과 안하는것의 차이는 무엇인가???
            // 데이터 바인딩을 했을때 i는 어떻게 적용이 되는가? 계속 다 처음부터 끝까지?
            // 데이터를 가져올때 d를 쓰는것과 dataSet을 쓰는 것의 차이
            // dataSet.values; 또는 dataSet[0].values.Year 이렇게 햇을때 아무것도 안나오는 이유는?
            // d3 안에서 for은 어떻게 사용이 되는 것인가?
           

       };
    
        </script>
</body>
</html>