<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Child labour</title>
    <style>
       
        #chart {
            border: 1px solid black;
        }
        
        
    </style>
    <script src="d3.min.js" type="text/javascript"></script>
</head>

<body>
    
    <svg id="chart" height="700" width="1000"></svg>



    <script>
       var dataSet = [];
        // labour data
        d3.csv('data/Child_labour.csv', function (err, labour) {
            d3.csv('data/attendance_in_primary_education.csv', function (err, attend) {
                labour.forEach(function (row) {
                    row['Labour'] = +row['Value'];
                });
                var labourMale = labour.filter(function (row) {
                    return row['Subgroup'].startsWith('Male');
                });
                var labourFemale = labour.filter(function (row) {
                    return row['Subgroup'].startsWith('Female');
                });
                attend.forEach(function (row) {
                    row['Attend'] = +row['Value'];
                });
                var attendMale = attend.filter(function (row) {
                    return row['Subgroup'].startsWith('Male');
                });
                var attendFemale = attend.filter(function (row) {
                    return row['Subgroup'].startsWith('Female');
                });


                //----------------------------------------CountryName----------------------------------------    

                var mergedDict = {};
                labourMale.forEach(function (row, i) {
                    var key = row['Country'];
                    mergedDict[key] = row;
                    mergedDict[key].LabourFemale = labourFemale[i].Labour;
                });
                attendMale.forEach(function (row, i) {
                    var key = row['Country'];
                    if (!mergedDict[key]) {
                        mergedDict[key] = row;
                    } else {
                        mergedDict[key]['Attend'] = row['Attend'];
                    }
                    mergedDict[key].AttendFemale = attendFemale[i].Attend;
                });

                var mergedData = [];
                for (var key in mergedDict) {
                    mergedData.push(mergedDict[key]);
                }
                
                dataSet = mergedData;
                          });
        });
        //------------------------------------------Draw------------------------------------------


        var MARGIN = {
            TOP: 0,
            LEFT: 200,
            RIGHT: 0,
            BOTTOM: 0,
        }

        var Width = document.querySelector('#chart').clientWidth;
        var Height = document.querySelector('#chart').clientHeight;

        var columnBand = d3.scale.ordinal()
            .domain(['ml', 'fl', 'me', 'fe'])
            .rangeRoundBands([MARGIN.LEFT, Width - MARGIN.RIGHT], 0.1);
        var yBand = d3.scale.ordinal()
            .domain(d3.range(dataSet.length))
            .rangeRoundBands([0, Height - MARGIN.TOP - MARGIN.BOTTOM], 0.1);
        
        var columnSel = d3.select('#chart').selectAll('g.column').data(columnBand.domain());
        columnSel.enter()
            .append('g')
            .attr('class', function (d) {
                return 'column ' + d;
            })
        .attr('fill',function(d){return 'rgb('+(d.length)*10+',30,30)';})
        columnSel.exit()
            .remove();
        columnSel
            .attr('transform', function (d) {
                return 'translate(' + columnBand(d) + ', ' + MARGIN.TOP + ')';//++의 정체는 무엇인가!!!
            });
        
        //
        //---------------------------------------- Labels
        var labelSel = d3.select('#chart').selectAll('text.label').data(dataSet);
        labelSel.enter()
            .append('text')
            .attr('class', 'label');
        labelSel.exit()
            .remove();
        labelSel
            .attr('transform', function (d, i) {
                return 'translate(' + MARGIN.LEFT + ', ' + yBand(i) + ')';
            })
            .attr('text-anchor', 'end')
            .attr('fill','black')
            .attr('alignment-baseline', 'text-before-edge')
            .text(function (d) {
                return d.Country;
               
            })
            ;
        console.log(labelSel);



        //-----------------------------------Country------------------------------------------
        //        function write() {
        //            var countryName = d3.select('body').selectAll('p').data(dataSet);
        //            countryName.enter().append('p').text(function (d) {
        //                return d['Country'];
        //            });
        //        }
    </script>
</body>

</html>